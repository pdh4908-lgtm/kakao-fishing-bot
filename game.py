
class FishingGame:
    def __init__(self, store):
        self.store = store

    def cmd_start(self, uid: str):
        u = self.store.load_user(uid)
        # ë‹‰ë„¤ì„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì•ˆë‚´
        if not u.get("nick_locked"):
            return (
                "ì²˜ìŒ ì˜¤ì…¨ë„¤ìš”! ë‹‰ë„¤ì„ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”. (ë‹‰ë„¤ì„ì€ ì´í›„ ë³€ê²½ ë¶ˆê°€)\n"
                "ì˜ˆ) /ë‹‰ë„¤ì„ ë‚šì‹œì™•ì¹´ì¹´ì˜¤"
            )

        # --- ìƒíƒœ ---
        status_block = (
            f"[ìƒíƒœ]\n"
            f"{u.get('title','ë‚šë¦°ì´')} {u.get('nick','-')} | "
            f"Lv.{u.get('lv',1)}  Exp:{u.get('exp',0)}/{u.get('next_exp',100)}\n"
            f"Gold:{u.get('gold',0)} | ì œí•œê³¨ë“œ:{u.get('limit_gold',0)}\n"
            f"ì¥ì†Œ: {u.get('place','ë¯¼ë¬¼')} | "
            f"ì¥ì°© ë‚šì‹œëŒ€: {u.get('rod','ëŒ€ë‚˜ë¬´ ë‚šì‹¯ëŒ€')}"
        )

        # --- ê°€ë°© ---
        bag_items = u.get("bag", [])
        bag_text = f"[ê°€ë°©]\n{len(bag_items)}/5ì¹¸ ì‚¬ìš©ì¤‘\n"
        for idx in range(5):
            if idx < len(bag_items):
                item = bag_items[idx]
                bag_text += f"{idx+1}. {item}\n"
            else:
                bag_text += f"{idx+1}. ë¹„ì–´ìˆìŒ\n"
        bag_text += "\në³´ìœ í•˜ì§€ ì•Šì€ ë¬¼í’ˆ: ì§€ë ì´, ì§‘ì–´ì œ, ì¼€ë¯¸ë¼ì´íŠ¸1ë“±ê¸‰, ì¼€ë¯¸ë¼ì´íŠ¸2ë“±ê¸‰, ì¼€ë¯¸ë¼ì´íŠ¸3ë“±ê¸‰"

        # --- ì¶œì„ ---
        if u.get("attended_today", False):
            attend_text = "[ì¶œì„]\nì˜¤ëŠ˜ì€ ì´ë¯¸ ì¶œì„í•˜ì…¨ìŠµë‹ˆë‹¤. (ê¸°ì¤€: ì„œìš¸ 00:00)"
        else:
            attend_text = "[ì¶œì„]\nì˜¤ëŠ˜ ì¶œì„ì„ ì•„ì§ í•˜ì§€ ì•Šìœ¼ì…¨ìŠµë‹ˆë‹¤.\nâœ… `/ì¶œì„` ì…ë ¥í•˜ë©´ ë³´ìƒ ê³¨ë“œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."

        # --- ë‚šì‹œ ìƒíƒœ ---
        if u.get("fishing", False):
            fish_text = f"[ë‚šì‹œ ìƒíƒœ]\nâ³ {u.get('place','ë¯¼ë¬¼')}ì—ì„œ ë‚šì‹œì¤‘ (ë‚¨ì€ ì‹œê°„: {u.get('remain',10)}ì´ˆ)"
        else:
            fish_text = "[ë‚šì‹œ ìƒíƒœ]\nğŸ£ í˜„ì¬ ë‚šì‹œì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤.\nì˜ˆ) `/ì¥ì†Œ ë¯¼ë¬¼` â†’ `/ë‚šì‹œ 15s` â†’ ì‹œê°„ì´ ì§€ë‚˜ë©´ `/ë¦´ê°ê¸°`"

        # --- ìƒì /ì•„ì´í…œ ê´€ë¦¬ ---
        shop_text = (
            "[ìƒì /ì•„ì´í…œ ê´€ë¦¬]\n"
            "â€¢ /ìƒì \n"
            "â€¢ /êµ¬ë§¤ [ë²ˆí˜¸]\n"
            "â€¢ /íŒë§¤ [ë²ˆí˜¸]\n"
            "â€¢ /ì „ë¶€íŒë§¤"
        )

        # --- ê¸°íƒ€ ëª…ë ¹ì–´ ---
        etc_text = (
            "[ê¸°íƒ€ ëª…ë ¹ì–´]\n"
            "â€¢ /ì´ˆë³´ìì°¬ìŠ¤   (ë‚šë¦°ì´ ì „ìš©, í•˜ë£¨ 3íšŒ)\n"
            "â€¢ /ì¼€ë¯¸ë¼ì´íŠ¸ ì‚¬ìš©\n"
            "â€¢ /ì§‘ì–´ì œì‚¬ìš©"
        )

        return f"{status_block}\n\n{bag_text}\n\n{attend_text}\n\n{fish_text}\n\n{shop_text}\n\n{etc_text}"
